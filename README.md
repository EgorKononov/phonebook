# Phonebook

Phonebook - pet-проект на Java + Spring Boot, представляющий собой REST-сервис для управления контактами.

Проект создан в учебных целях и демонстрирует использование Spring Boot, работу с базой данных, контейнеризацию приложения и покрытие его тестами.

---

## Описание приложения и его функциональность
Приложение предоставляет REST API для работы с контактами и включает два CRUD сервиса:

### Contacts
CRUD операции для управления контактами:

- создание контакта
- получение контакта по ID
- получение списка контактов с пагинацией и фильтрацией
- обновление контакта
- удаление контакта

Контакт содержит основные данные (имя, телефон, email и т.д.) и ссылку на компанию.

### Companies
CRUD операции для управления компаниями:

- создание компании
- получение компании по ID
- получение списка компаний с пагинацией и фильтрацией
- обновление компании
- удаление компании

Компания является отдельной сущностью и используется как одно из полей сущности контакта.

## Версионирование API
В проекте используется версионирование REST API на уровне URL. Текущая версия API: v1

Все публичные эндпоинты имеют префикс версии:

```bash
/api/v1/contacts
/api/v1/companies
```

При развитии приложения новые версии API будут добавляться без нарушения обратной совместимости существующих клиентов.

## Архитектура приложения
Приложение построено по классической слоистой архитектуре:

- Controller layer — REST-контроллеры, принимающие и валидирующие входящие запросы
- Service layer — бизнес-логика, управление транзакциями
- Repository layer — доступ к данным через Spring Data JPA и QueryDSL
- DTO / Mapper layer — разделение API-моделей и persistence-сущностей

Такое разделение упрощает тестирование, поддержку и дальнейшее расширение функциональности.
Данная архитектура соответствует общепринятым практикам Spring-приложений и позволяет легко масштабировать проект.

## Ключевые архитектурные решения
- QueryDSL выбран для реализации фильтрации без роста количества методов репозиториев
- Liquibase используется для контролируемого изменения схемы базы данных
- DTO применяются для изоляции REST API от изменений persistence-сущностей
- Для операций создания и обновления используются Write DTO, а для чтения - отдельные Read DTO. Это защищает данные от непреднамеренного изменения и упрощает расширение функциональности
- Docker используются для упрощения локального запуска и воспроизводимости окружения

---

## Требования
Для локального запуска проекта необходимо:

- Java 21+
- Gradle
- Docker

---

## Сборка и запуск проекта

### Сборка проекта
Для сборки приложения выполните:

```bash
./gradlew clean build
```

### Запуск без Docker
Для запуска приложения локально выполните:

```bash
./gradlew bootRun
```

### Запуск с использованием Docker
Для запуска приложения и базы данных выполните:

```bash
docker compose up
```

После запуска приложение доступно на http://localhost:8080

Swagger / OpenAPI: http://localhost:8080/swagger-ui/index.html

PostgreSQL запускается в отдельном Docker контейнере

---

## Используемые технологии
### Spring Boot
Spring Boot является основным фреймворком приложения и используется для:

- автоконфигурации приложения
- запуска embedded Tomcat
- работы с зависимостями
- построения REST API
- работы с профилями

### Spring Data JPA + QueryDSL
Для работы с базой данных используется Spring Data JPA и QueryDSL:

- работа с сущностями и транзакциями
- репозитории реализованы через JpaRepository
- пагинация (Page, Pageable)
- динамическая фильтрация с помощью QueryDSL
- в качестве базы данных используется PostgreSQL

### Liquibase
Liquibase применяется для управления схемой базы данных:

- все изменения БД версионируются
- миграции описываются в changelog-файлах
- автоматический запуск миграций при старте приложения
- контроль целостности структуры БД

### Docker
Docker используется для контейнеризации:

- изолированная среда запуска приложения
- запуск базы данных в контейнере
- сохранение логов приложения в Docker volume

### Externalized Configuration

Конфигурация приложения вынесена за пределы исходного кода и управляется через переменные окружения, .env файлы и Spring Profiles.

### Spring Validation
Для валидации входящих данных применяется Spring Validation:
 
- стандартная валидация (@NotNull, @NotBlank, @Email и т.д.)
- кастомные валидационные аннотации
- разные правила валидации для операций создания и обновления

### Unit-тестирование
Unit-тесты используются для проверки бизнес-логики приложения:

- тестирование слоя сервисов
- изоляция зависимостей с помощью Mockito

### Integration-тестирование
Integration-тесты проверяют работу приложения целиком:

- тестирование REST-контроллеров через MockMvc
- тестирование слоя сервисов и репозиториев
- использование Testcontainers для поднятия базы данных в тестах

### Swagger / OpenAPI
Для документирования REST API используется Swagger / OpenAPI

- автоматическая генерация OpenAPI спецификации
- интерактивная документация Swagger UI
- возможность тестировать REST API через браузер

### Нефункциональные аспекты
- Валидация входящих данных выполняется на уровне DTO
- Обработка ошибок централизована через @RestControllerAdvice
- Транзакционность управляется на сервисном слое
- Логи приложения пишутся в Docker volume и сохраняются между перезапусками контейнеров
